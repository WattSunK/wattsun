<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Track Order - WattSun Solar</title>
<link href="/main.css" rel="stylesheet"/>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding-bottom: 56px;
    background: #fefdf8;
  }
  header {
    background-color: #fff;
    padding: 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    position: relative;
  }
  .header-bar h1 {
    font-size: 1.5em;
    margin: 0;
  }
  nav {
    display: none;
  }
  nav.nav-open {
    display: flex;
    flex-direction: column;
    background: #fff;
    position: absolute;
    top: 56px;
    right: 0;
    width: 80%;
    box-shadow: 0 6px 12px rgba(0,0,0,0.1);
    z-index: 1000;
  }
  nav a {
    padding: 14px;
    text-decoration: none;
    color: #333;
    border-bottom: 1px solid #eee;
  }
  .nav-toggle {
    font-size: 1.8em;
    background: none;
    border: none;
    cursor: pointer;
  }
  .account-section {
    max-width: 800px;
    margin: 20px auto;
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  }
  .account-section h2 {
    font-size: 1.2em;
    color: #444;
    margin-bottom: 10px;
  }
  .account-section p {
    font-size: 0.95em;
    color: #555;
  }
  .account-section input, .account-section select, .account-section button {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
    font-size: 1em;
    border: 1px solid #ccc;
    border-radius: 6px;
    box-sizing: border-box;
  }
  .account-section button {
    background-color: #f4a940;
    color: white;
    font-weight: bold;
    border: none;
    cursor: pointer;
  }
  .account-section button:hover {
    background-color: #e7991f;
  }
  .result-box {
    margin-top: 20px;
    background: #f7f7f7;
    padding: 15px;
    border-radius: 8px;
  }
  .mobile-nav {
    display: none;
  }
  @media (max-width: 768px) {
    .mobile-nav {
      display: flex;
      position: fixed;
      bottom: 0;
      height: 56px;
      width: 100%;
      background-color: #f4a940;
      justify-content: space-around;
      align-items: center;
      z-index: 1000;
      box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.1);
      padding: 0;
    }
    .mobile-nav a {
      font-size: 20px;
      height: 56px;
      line-height: 56px;
      padding: 0;
      margin: 0;
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      color: black;
      position: relative;
    }
    #cart-count {
      position: absolute;
      top: 6px;
      right: 10px;
      background: red;
      color: white;
      font-size: 11px;
      min-width: 16px;
      height: 16px;
      border-radius: 8px;
      padding: 0 5px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
    }
  }
</style>
</head>
<body>
<header>
  <div class="header-bar">
    <h1 class="desktop-logo">
      <img alt="WattSun Solar Logo" src="/assets/logo/Wattsun Solar log2.png" style="width: 60px; object-fit: contain; margin-right: 10px;"/>
      WattSun Solar
    </h1>
    <div class="logo-container">
      <img alt="WattSun Solar Logo" class="site-logo" src="/assets/logo/Wattsun Solar log2.png"/>
      <span class="brand-name">WattSun Solar</span>
    </div>
    <button aria-label="Toggle Menu" class="nav-toggle" onclick="document.querySelector('nav').classList.toggle('nav-open')">‚ò∞</button>
  </div>
  <nav>
    <a href="/index.html">Home</a>
    <a href="/shop.html">Shop</a>
    <a href="/calculators/calculator.html">Calculator</a>
    <a href="/financing.html">Financing</a>
    <a href="/projects.html">Projects</a>
    <a href="/contact.html">Contact</a>
  </nav>
</header>

<div class="account-section">
  <h2>Track Your WattSun Order</h2>
  <p>Enter your phone number and status to get the latest update:</p>
  <div style="display: flex; gap: 10px;">
    <input placeholder="+254 7XX XXX XXX" id="track-phone" type="tel" style="flex: 1;"/>
    <select id="track-status" style="flex: 1;">
      <option value="Pending">Pending</option>
      <option value="Delivered">Delivered</option>
      <option value="Cancelled">Cancelled</option>
    </select>
  </div>
  <button id="track-btn">Check Status</button>
  <div id="track-result" class="result-box" style="display:none;"></div>
</div>

<div class="account-section">
  <h2>Need Help?</h2>
  <p><a href="mailto:info@wattsun.co.ke">info@wattsun.co.ke</a></p>
  <p><a href="/contact.html">Contact Page</a></p>
</div>

<footer class="mobile-nav">
  <a aria-label="Home" href="/index.html">üè†</a>
  <a aria-label="Account" href="/myaccount/track.html">üë§</a>
  <a aria-label="Cart" href="/cart.html">üõí<span id="cart-count">0</span></a>
  <a aria-label="Menu" href="javascript:void(0);" onclick="document.querySelector('nav').classList.toggle('nav-open')">‚ò∞</a>
</footer>

<script>
function updateCartCountBadge() {
  let count = 0;
  try {
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    count = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
  } catch (e) {}
  const badge = document.getElementById('cart-count');
  if (badge) badge.textContent = count;
}
document.addEventListener('DOMContentLoaded', updateCartCountBadge);
window.addEventListener('storage', updateCartCountBadge);
</script>

<script>
document.getElementById('track-btn').addEventListener('click', async () => {
  const phone = document.getElementById('track-phone').value.trim();
  const status = document.getElementById('track-status').value;
  const resultBox = document.getElementById('track-result');
  resultBox.style.display = 'none';
  resultBox.innerHTML = '';

  if (!phone) return alert("Please enter your phone number.");

  const res = await fetch("/api/track", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ phone, status })
  });

  let data;
  try {
    data = await res.json();
  } catch (err) {
    alert("Invalid server response.");
    return;
  }

  if (!res.ok || !Array.isArray(data)) {
    alert(data.error || "Something went wrong.");
    return;
  }

  if (!data.length) {
    resultBox.innerHTML = `<p>No orders found for this phone number and status.</p>`;
  } else {
    resultBox.innerHTML = data.map(order => `
      <p><strong>Status:</strong> ${order.status}</p>
      <p><strong>Last Updated:</strong> ${new Date(order.updatedAt).toLocaleString()}</p>
      <p><strong>Order Number:</strong> ${order.orderNumber}</p>
      <p><strong>Items:</strong><br>${(order.cart_summary || "N/A").replaceAll("\n", "<br>")}</p>
      <hr>
    `).join("");
  }

  resultBox.style.display = 'block';
});
</script>
</body>
</html>
