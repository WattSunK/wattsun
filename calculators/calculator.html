<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>Solar Kit Calculator - WattSun Solar</title>
  <link href="../main.css" rel="stylesheet"/>
  <style>
    body { background: #f7f7f7; margin: 0; color: #333; font-family: Arial, sans-serif; }
    .container { width: 100%; max-width: 600px; margin: 44px auto 40px auto; background: #fff; border-radius: 18px; box-shadow: 0 4px 22px rgba(44,62,80,0.10); padding: 38px 22px 34px 22px; }
    h2 { text-align: center; margin-bottom: 18px; font-size: 2em; font-weight: bold; }
    p { text-align:center; color:#666; margin-bottom:30px; font-size:1.13em; }
    label { font-weight: bold; font-size: 1.08em; }
    input[type="number"] { width: 94%; max-width: 80px; padding: 10px; font-size: 1em; border-radius: 8px; border: 1.2px solid #ccc; background: #faf9f7; margin: 0 0 10px 0; text-align: center;}
    input[type="number"]:focus { border-color: #f7b733; outline: none; }
    .calc-section-header { font-size: 1.13em; font-weight: bold; color: #184211; cursor: pointer; display: flex; align-items: center; gap: 8px; padding: 9px 0; user-select: none; }
    .calc-chevron { font-size: 1.2em; transition: transform 0.2s; color: #b39708; }
    .calc-section.collapsed .calc-chevron { transform: rotate(-90deg);}
    .calc-grid { display: grid; grid-template-columns: 1fr 90px; gap: 0 8px; align-items: center; }
    .calc-section.collapsed .calc-section-body { display: none; }
    .loan-btn, .btn-main, .cart-btn { width: 100%; max-width: 350px; background: linear-gradient(90deg, #f7b733 0%, #fcf6ba 100%); color: #184211; border: none; padding: 14px 0; border-radius: 24px; font-size: 1.13em; font-weight: 600; cursor: pointer; margin: 18px auto 4px auto; display: block; box-shadow: 0 3px 18px rgba(247,183,51,0.11); transition: background 0.15s, color 0.12s, transform 0.1s;}
    .loan-btn:hover, .btn-main:hover, .cart-btn:hover { background: linear-gradient(90deg, #fcf6ba 0%, #f7b733 100%); color: #b37900 !important; transform: translateY(-1px) scale(1.02); }
    .result { margin-top: 18px; text-align: center; font-weight: bold; font-size: 1.16em; background: #fff5c2; border-radius: 8px; padding: 18px 8px 10px 8px; transition: background 0.3s; min-height: 38px; }
    .result-flash { background: #fff5c2 !important; }
    .disclaimer { font-size: 0.98em; text-align: center; color: #888; margin-top: 14px; }
    /* Fix header/nav green bar */
    header, nav { border: none !important; box-shadow: none !important; background-image: none !important; }
    nav { background: transparent !important; }
    /* Remove green bar if added by .active styles in main.css */
    nav a.active { box-shadow: none !important; border-bottom: none !important; background: none !important; }

    /* Cart badge fix */
    .cart-icon-link { position: relative; }
    .cart-count-badge { position: absolute; top: -0.7em; right: -1.2em; background: #19c37d; color: #fff; font-size: 0.84em; min-width: 1.2em; height: 1.2em; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; box-shadow: 0 0 0.13em #0001; z-index: 1; }

    @media (max-width: 700px) {
      .container { max-width: 98vw; width: 100vw !important; border-radius: 0 !important; padding-left: 2vw !important; padding-right: 2vw !important; }
      .calc-section-body.calc-grid { grid-template-columns: 1fr 80px !important; gap: 0 5vw !important;}
      h2 { font-size: 1.3em !important; }
    }
    /* Mobile: force label above input */
    @media (max-width: 768px) {
      .calc-grid { grid-template-columns: 1fr 1fr !important; }
      .calc-section-body label { grid-column: 1; text-align: left; }
      .calc-section-body input[type="number"] { grid-column: 2; }
      .mobile-nav {
        display: flex;
        position: fixed;
        bottom: 0;
        height: 56px;
        width: 100%;
        background-color: #f4a940;
        justify-content: space-around;
        align-items: center;
        z-index: 1000;
        box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.1);
      }
      .mobile-nav a {
        font-size: 20px;
        text-decoration: none;
        color: black;
        position: relative;
        line-height: 1;
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      #cart-count {
        position: absolute;
        top: 6px;
        right: 10px;
        background: red;
        color: white;
        font-size: 11px;
        min-width: 16px;
        height: 16px;
        border-radius: 8px;
        padding: 0 5px;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
      }
    }
    /* Desktop footer always pinned to bottom */
    @media (min-width: 769px) {
      body { min-height: 100vh; display: flex; flex-direction: column; }
      .container { flex: 1; }
      footer:not(.mobile-nav) { margin-top: auto; background: #fff; border-top: 1px solid #f1eab6; text-align: center; padding: 14px 0 10px 0; }
    }
  </style>
</head>
<body>
<header>
  <div class="header-bar">
    <h1 class="desktop-logo">
      <img alt="WattSun Solar Logo" src="../assets/logo/Wattsun Solar log2.png" style="width: 60px; object-fit: contain; margin-right: 10px;"/>
      WattSun Solar
    </h1>
    <div class="logo-container">
      <img alt="WattSun Solar Logo" class="site-logo" src="../assets/logo/Wattsun Solar log2.png"/>
      <span class="brand-name">WattSun Solar</span>
    </div>
    <button aria-label="Menu" class="nav-toggle" onclick="toggleNav()">‚ò∞</button>
  </div>
  <nav>
    <a href="../index.html">Home</a>
    <a href="../solutions.html">Solutions</a>
    <a href="../shop.html">Shop</a>
    <a href="calculator.html" aria-current="page" class="active">Calculator</a>
    <a href="../financing.html">Financing</a>
    <a href="../projects.html">Projects</a>
    <a href="../contact.html">Contact</a>
    <a aria-label="View shopping cart" class="cart-icon-link" href="/cart.html" title="View cart">
      <span class="cart-icon">üõí<span class="cart-count-badge">0</span></span>
    </a>
  </nav>
</header>
<div class="container">
  <h2>Solar Kit Calculator</h2>
  <p>
    Select the appliances you want to power, then click <b>Calculate</b> to see the best solar kit for your needs!
  </p>
  <form autocomplete="off" class="calculator-form" id="solarForm">
    <!-- Lighting & Devices (expanded) -->
    <div class="calc-section" id="section-lighting">
      <div class="calc-section-header" onclick="toggleSection('section-lighting')">
        <span class="calc-chevron" id="chevron-lighting">‚ñº</span> Lighting &amp; Devices
      </div>
      <div class="calc-section-body calc-grid">
        <label for="led_bulb">LED Bulbs</label>
        <input id="led_bulb" min="0" name="led_bulb" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="tv">TV</label>
        <input id="tv" min="0" name="tv" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="laptop">Laptop</label>
        <input id="laptop" min="0" name="laptop" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="phone">Phone Charging</label>
        <input id="phone" min="0" name="phone" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="radio">Radio</label>
        <input id="radio" min="0" name="radio" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="fan">Fan</label>
        <input id="fan" min="0" name="fan" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="cctv">CCTV/Security System</label>
        <input id="cctv" min="0" name="cctv" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
      </div>
    </div>
    <!-- Kitchen Appliances (collapsed by default) -->
    <div class="calc-section collapsed" id="section-kitchen">
      <div class="calc-section-header" onclick="toggleSection('section-kitchen')">
        <span class="calc-chevron" id="chevron-kitchen">‚ñº</span> Kitchen Appliances
      </div>
      <div class="calc-section-body calc-grid">
        <label for="fridge">Fridge</label>
        <input id="fridge" min="0" name="fridge" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="kettle">Kettle</label>
        <input id="kettle" min="0" name="kettle" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="cooker">Cooker/Hotplate</label>
        <input id="cooker" min="0" name="cooker" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="microwave">Microwave</label>
        <input id="microwave" min="0" name="microwave" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="oven">Electric Oven</label>
        <input id="oven" min="0" name="oven" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="freezer">Deep Freezer</label>
        <input id="freezer" min="0" name="freezer" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="washer">Washing Machine</label>
        <input id="washer" min="0" name="washer" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
      </div>
    </div>
    <!-- Heavy Loads (collapsed by default) -->
    <div class="calc-section collapsed" id="section-heavy">
      <div class="calc-section-header" onclick="toggleSection('section-heavy')">
        <span class="calc-chevron" id="chevron-heavy">‚ñº</span> Heavy Loads
      </div>
      <div class="calc-section-body calc-grid">
        <label for="pump">Water Pump (small)</label>
        <input id="pump" min="0" name="pump" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="iron">Iron Box</label>
        <input id="iron" min="0" name="iron" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="heater">Water Heater</label>
        <input id="heater" min="0" name="heater" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="ac">AC (Split Unit)</label>
        <input id="ac" min="0" name="ac" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="tools">Power Tools</label>
        <input id="tools" min="0" name="tools" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="borehole">Borehole Pump</label>
        <input id="borehole" min="0" name="borehole" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
      </div>
    </div>
    <button class="loan-btn" type="button" onclick="calculateKit()">Calculate</button>
  </form>
  <div class="result" id="result" style="display:none;"></div>
  <div class="disclaimer">* This is an indicative estimate. Actual system sizing may vary.</div>
</div>
<footer>
  ¬© 2025 WattSun Solar Kenya | 
  <div class="footer-contacts"><a href="mailto:info@wattsun.co.ke">info@wattsun.co.ke</a></div>
</footer>
<footer class="mobile-nav">
  <a aria-label="Home" href="../index.html">üè†</a>
  <a aria-label="Account" href="../account.html">üë§</a>
  <a aria-label="Cart" href="/cart.html">
    <span class="cart-icon">üõí
      <span class="cart-count-badge">0</span>
    </span>
  </a>
  <a aria-label="Menu" href="javascript:void(0);" onclick="document.querySelector('.nav-toggle').click();">‚ò∞</a>
</footer>
<script>
// --- UI Functions ---
function toggleSection(id) {
  const section = document.getElementById(id);
  section.classList.toggle('collapsed');
}
function sanitizeInput(input) {
  input.value = Math.max(0, parseInt(input.value) || 0);
}

// --- Cart Count Logic (shared with shop.html) ---
function updateCartCountBadge() {
  let count = 0;
  try {
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    count = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
  } catch(e){}
  document.querySelectorAll('.cart-count-badge').forEach(badge => {
    badge.textContent = count;
    badge.style.display = count > 0 ? 'flex' : 'none';
  });
  const mobileCount = document.getElementById('cart-count');
  if (mobileCount) {
    mobileCount.textContent = count;
    mobileCount.style.display = count > 0 ? 'flex' : 'none';
  }
}
document.addEventListener('DOMContentLoaded', updateCartCountBadge);
window.addEventListener('storage', updateCartCountBadge);

// --- Hamburger menu ---
function toggleNav() {
  var header = document.querySelector("header");
  header.classList.toggle("nav-open");
}
document.body.addEventListener("click", function (e) {
  const header = document.querySelector("header");
  const nav = document.querySelector("header nav");
  const navToggle = document.querySelector(".nav-toggle");
  if (
    header.classList.contains("nav-open") &&
    !nav.contains(e.target) &&
    !navToggle.contains(e.target)
  ) {
    header.classList.remove("nav-open");
  }
}, true);

// --- CALCULATOR LOGIC WITH FORMATTED RESULT ---
function calculateKit() {
  const form = document.getElementById('solarForm');
  const inputs = form.querySelectorAll('input[type="number"]');
  let data = {};
  inputs.forEach(input => {
    let val = parseInt(input.value) || 0;
    if (val > 0) data[input.name] = val;
  });

  const resultDiv = document.getElementById('result');
  // Remove any previous button
  let existingBtn = document.getElementById('addToCartBtn');
  if (existingBtn) existingBtn.remove();

  if (Object.keys(data).length === 0) {
    resultDiv.innerHTML = '<span style="color:red">Please select at least one appliance.</span>';
    resultDiv.style.display = 'block';
    return;
  }

  resultDiv.innerHTML = 'Calculating...';
  resultDiv.style.display = 'block';

  fetch('/api/Kitcalculate', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  })
  .then(res => res.json())
  .then(res => {
    resultDiv.innerHTML =
      `<div style="font-size:1.17em; font-weight:600; margin-bottom:3px; color:#214000;">Recommended Kit: <span style="font-weight:bold">${res.recommended}</span></div>
      <div style="font-size:1.08em; margin-bottom:2px;">Estimated Price: <span style="color:#b39708; font-weight:700;">KES ${res.price.toLocaleString()}</span></div>
      <div style="font-size:1.08em; margin-bottom:4px;">Total Power: <span style="font-weight:bold">${res.power} W</span></div>`;
    resultDiv.style.display = 'block';
    resultDiv.classList.add('result-flash');
    setTimeout(() => { resultDiv.classList.remove('result-flash'); }, 1600);

    // "Add to Cart" button
    const btn = document.createElement('button');
    btn.textContent = "Add to Cart";
    btn.id = "addToCartBtn";
    btn.className = "cart-btn";
    btn.onclick = function(e) {
      e.preventDefault();
      // Merge with existing kit in cart or add new
      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      const index = cart.findIndex(item => item.name === res.recommended && item.type === "kit");
      if (index > -1) {
        cart[index].quantity = (cart[index].quantity || 1) + 1;
      } else {
        cart.push({
          name: res.recommended,
          price: res.price,
          quantity: 1,
          type: "kit",
          description: `Custom kit calculated (${res.power}W)`,
        });
      }
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCartCountBadge();
      btn.remove();
      resultDiv.innerHTML = `<span style="color:green;">Added to cart!</span>`;
      setTimeout(() => { resultDiv.innerHTML = ""; resultDiv.style.display = 'none'; }, 1200);
      form.reset();
    };
    resultDiv.after(btn);
  })
  .catch(() => {
    resultDiv.innerHTML = '<span style="color:red">Error calculating kit. Please try again.</span>';
  });
}
</script>
</body>
</html>
