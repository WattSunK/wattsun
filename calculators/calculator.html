<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>Solar Kit Calculator - WattSun Solar</title>
  <link href="../main.css" rel="stylesheet"/>
  <style>
    body { background: #f7f7f7; margin: 0; color: #333; font-family: Arial, sans-serif; }
    .container { width: 100%; max-width: 600px; margin: 44px auto 40px auto; background: #fff; border-radius: 18px; box-shadow: 0 4px 22px rgba(44,62,80,0.10); padding: 38px 22px 34px 22px; }
    h2 { text-align: center; margin-bottom: 18px; font-size: 2em; font-weight: bold; }
    p { text-align:center; color:#666; margin-bottom:30px; font-size:1.13em; }
    label { font-weight: bold; font-size: 1.08em; }
    input[type="number"] { width: 100%; padding: 10px; font-size: 1em; border-radius: 8px; border: 1.2px solid #ccc; background: #faf9f7; margin: 0 0 10px 0; }
    input[type="number"]:focus { border-color: #f7b733; outline: none; }
    .calc-section-header { font-size: 1.13em; font-weight: bold; color: #184211; cursor: pointer; display: flex; align-items: center; gap: 8px; padding: 9px 0; user-select: none; }
    .calc-chevron { font-size: 1.2em; transition: transform 0.2s; color: #b39708; }
    .calc-section.collapsed .calc-chevron { transform: rotate(-90deg);}
    .calc-grid { display: grid; grid-template-columns: 1fr 90px; gap: 0 8px; align-items: center; }
    .calc-section.collapsed .calc-section-body { display: none; }
    .loan-btn, .btn-main { width: 100%; background: #ffc043; color: #fff; border: none; padding: 15px; border-radius: 6px; font-size: 1.12em; font-weight: 600; cursor: pointer; transition: background 0.2s, color 0.2s; margin: 12px 0 4px 0; box-shadow: 0 3px 18px rgba(247,183,51,0.11); }
    .loan-btn:hover, .btn-main:hover { background: #ffb347; color: #965700; }
    .result { margin-top: 18px; text-align: center; font-weight: bold; font-size: 1.16em; background: #fff5c2; border-radius: 8px; padding: 18px 8px 10px 8px; transition: background 0.3s; min-height: 38px; }
    .result-flash { background: #fff5c2 !important; }
    .disclaimer { font-size: 0.98em; text-align: center; color: #888; margin-top: 14px; }
    .cart-btn { background: #ffc043; color: white; font-weight: bold; border: none; border-radius: 6px; cursor: pointer; box-shadow: 0 3px 12px rgba(0,0,0,0.06); margin: 14px auto 0 auto; padding: 12px 28px; display: block; }
    .cart-btn:hover { background: #ffb347; color: #965700; }
    @media (max-width: 700px) {
      .container { max-width: 98vw; width: 100vw !important; border-radius: 0 !important; padding-left: 2vw !important; padding-right: 2vw !important; }
      .calc-grid { grid-template-columns: 1fr !important; gap: 2px 0 !important; }
      h2 { font-size: 1.3em !important; }
    }
    /* Mobile nav/footer styles */
    .mobile-nav { display: none; }
    @media (max-width: 768px) {
      .mobile-nav {
        display: flex;
        position: fixed;
        bottom: 0;
        height: 56px;
        width: 100%;
        background-color: #f4a940;
        justify-content: space-around;
        align-items: center;
        z-index: 1000;
        box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.1);
      }
      .mobile-nav a {
        font-size: 20px;
        text-decoration: none;
        color: black;
        position: relative;
        line-height: 1;
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      #cart-count {
        position: absolute;
        top: 6px;
        right: 10px;
        background: red;
        color: white;
        font-size: 11px;
        min-width: 16px;
        height: 16px;
        border-radius: 8px;
        padding: 0 5px;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
<header>
  <div class="header-bar">
    <h1 class="desktop-logo">
      <img alt="WattSun Solar Logo" src="../assets/logo/Wattsun Solar log2.png" style="width: 60px; object-fit: contain; margin-right: 10px;"/>
      WattSun Solar
    </h1>
    <div class="logo-container">
      <img alt="WattSun Solar Logo" class="site-logo" src="../assets/logo/Wattsun Solar log2.png"/>
      <span class="brand-name">WattSun Solar</span>
    </div>
    <button aria-label="Menu" class="nav-toggle" onclick="toggleNav()">‚ò∞</button>
  </div>
  <nav>
    <a href="../index.html">Home</a>
    <a href="../solutions.html">Solutions</a>
    <a href="../shop.html">Shop</a>
    <a href="calculator.html" aria-current="page" class="active">Calculator</a>
    <a href="../financing.html">Financing</a>
    <a href="../projects.html">Projects</a>
    <a href="../contact.html">Contact</a>
    <a aria-label="View shopping cart" class="cart-icon-link" href="/cart.html" title="View cart">
      <span class="cart-icon">üõí<span class="cart-count-badge" style="background:#19c37d; color:white; font-weight:bold;">0</span></span>
    </a>
  </nav>
</header>
<div class="container">
  <h2>Solar Kit Calculator</h2>
  <p>
    Select the appliances you want to power, then click <b>Calculate</b> to see the best solar kit for your needs!
  </p>
  <form autocomplete="off" class="calculator-form" id="solarForm">
    <!-- Lighting & Devices (expanded) -->
    <div class="calc-section" id="section-lighting">
      <div class="calc-section-header" onclick="toggleSection('section-lighting')">
        <span class="calc-chevron" id="chevron-lighting">‚ñº</span> Lighting &amp; Devices
      </div>
      <div class="calc-section-body calc-grid">
        <label for="led_bulb">LED Bulbs</label>
        <input id="led_bulb" min="0" name="led_bulb" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="tv">TV</label>
        <input id="tv" min="0" name="tv" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="laptop">Laptop</label>
        <input id="laptop" min="0" name="laptop" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="phone">Phone Charging</label>
        <input id="phone" min="0" name="phone" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="radio">Radio</label>
        <input id="radio" min="0" name="radio" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="fan">Fan</label>
        <input id="fan" min="0" name="fan" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="cctv">CCTV/Security System</label>
        <input id="cctv" min="0" name="cctv" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
      </div>
    </div>
    <!-- Kitchen Appliances (collapsed by default) -->
    <div class="calc-section collapsed" id="section-kitchen">
      <div class="calc-section-header" onclick="toggleSection('section-kitchen')">
        <span class="calc-chevron" id="chevron-kitchen">‚ñº</span> Kitchen Appliances
      </div>
      <div class="calc-section-body calc-grid">
        <label for="fridge">Fridge</label>
        <input id="fridge" min="0" name="fridge" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="kettle">Kettle</label>
        <input id="kettle" min="0" name="kettle" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="cooker">Cooker/Hotplate</label>
        <input id="cooker" min="0" name="cooker" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="microwave">Microwave</label>
        <input id="microwave" min="0" name="microwave" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="oven">Electric Oven</label>
        <input id="oven" min="0" name="oven" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="freezer">Deep Freezer</label>
        <input id="freezer" min="0" name="freezer" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="washer">Washing Machine</label>
        <input id="washer" min="0" name="washer" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
      </div>
    </div>
    <!-- Heavy Loads (collapsed by default) -->
    <div class="calc-section collapsed" id="section-heavy">
      <div class="calc-section-header" onclick="toggleSection('section-heavy')">
        <span class="calc-chevron" id="chevron-heavy">‚ñº</span> Heavy Loads
      </div>
      <div class="calc-section-body calc-grid">
        <label for="pump">Water Pump (small)</label>
        <input id="pump" min="0" name="pump" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="iron">Iron Box</label>
        <input id="iron" min="0" name="iron" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="heater">Water Heater</label>
        <input id="heater" min="0" name="heater" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="ac">AC (Split Unit)</label>
        <input id="ac" min="0" name="ac" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="tools">Power Tools</label>
        <input id="tools" min="0" name="tools" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
        <label for="borehole">Borehole Pump</label>
        <input id="borehole" min="0" name="borehole" oninput="sanitizeInput(this)" step="1" type="number" value="0"/>
      </div>
    </div>
    <button class="loan-btn" type="button" onclick="calculateKit()">Calculate</button>
  </form>
  <div class="result" id="result" style="display:none;"></div>
  <div class="disclaimer">* This is an indicative estimate. Actual system sizing may vary.</div>
</div>
<footer>
  ¬© 2025 WattSun Solar Kenya | 
  <div class="footer-contacts"><a href="mailto:info@wattsun.co.ke">info@wattsun.co.ke</a></div>
</footer>
<footer class="mobile-nav">
  <a aria-label="Home" href="../index.html">üè†</a>
  <a aria-label="Account" href="../account.html">üë§</a>
  <a aria-label="Cart" href="/cart.html">
    <span class="cart-icon">üõí
      <span class="cart-count-badge">0</span>
    </span>
  </a>
  <a aria-label="Menu" href="javascript:void(0);" onclick="document.querySelector('.nav-toggle').click();">‚ò∞</a>
</footer>
<script>
function toggleSection(id) {
  const section = document.getElementById(id);
  section.classList.toggle('collapsed');
}
function sanitizeInput(input) {
  input.value = Math.max(0, parseInt(input.value) || 0);
}

// CALCULATOR LOGIC WITH FORMATTED RESULT
function calculateKit() {
  const form = document.getElementById('solarForm');
  const inputs = form.querySelectorAll('input[type="number"]');
  let data = {};
  inputs.forEach(input => {
    let val = parseInt(input.value) || 0;
    if (val > 0) data[input.name] = val;
  });

  const resultDiv = document.getElementById('result');
  if (Object.keys(data).length === 0) {
    resultDiv.innerHTML = '<span style="color:red">Please select at least one appliance.</span>';
    resultDiv.style.display = 'block';
    return;
  }

  resultDiv.innerHTML = 'Calculating...';
  resultDiv.style.display = 'block';

  fetch('/api/Kitcalculate', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  })
  .then(res => res.json())
  .then(res => {
    // Formatting result and highlight
    resultDiv.innerHTML =
      `<span style="font-size:1.13em; color:#214000;">Recommended Kit:</span> <span style="font-size:1.1em; font-weight:bold;">${res.recommended}</span><br>
      <span style="font-size:1.08em;">Estimated Price: <b style="color:#b39708;">KES ${res.price.toLocaleString()}</b></span><br>
      <span style="font-size:1.08em;">Total Power: <b>${res.power} W</b></span>`;
    resultDiv.style.display = 'block';
    resultDiv.classList.add('result-flash');
    setTimeout(() => { resultDiv.classList.remove('result-flash'); }, 1800);

    // Add "Add to Cart" button after result
    let existingBtn = document.getElementById('addToCartBtn');
    if (!existingBtn) {
      const btn = document.createElement('button');
      btn.textContent = "Add to Cart";
      btn.id = "addToCartBtn";
      btn.className = "cart-btn";
      btn.onclick = function(e) {
        e.preventDefault();
        // Add this kit to the cart in localStorage
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        cart.push({
          name: res.recommended,
          price: res.price,
          quantity: 1,
          type: "kit",
          description: `Custom kit calculated (${res.power}W)`,
        });
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCountBadge();
        btn.remove();
        resultDiv.innerHTML = `<span style="color:green;">Added to cart!</span>`;
        setTimeout(() => { resultDiv.innerHTML = ""; resultDiv.style.display = 'none'; }, 1300);
        form.reset();
      };
      resultDiv.after(btn);
    }
  })
  .catch(() => {
    resultDiv.innerHTML = '<span style="color:red">Error calculating kit. Please try again.</span>';
  });
}

// Cart count badge logic
function updateCartCountBadge() {
  let count = 0;
  try {
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    count = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
  } catch(e){}
  document.querySelectorAll('.cart-count-badge').forEach(badge => {
    badge.textContent = count;
    badge.style.display = count > 0 ? 'flex' : 'none';
  });
  const mobileCount = document.getElementById('cart-count');
  if (mobileCount) {
    mobileCount.textContent = count;
    mobileCount.style.display = count > 0 ? 'flex' : 'none';
  }
}
document.addEventListener('DOMContentLoaded', updateCartCountBadge);
window.addEventListener('storage', updateCartCountBadge);

// Hamburger menu logic
function toggleNav() {
  var header = document.querySelector("header");
  header.classList.toggle("nav-open");
}
document.body.addEventListener("click", function (e) {
  const header = document.querySelector("header");
  const nav = document.querySelector("header nav");
  const navToggle = document.querySelector(".nav-toggle");
  if (
    header.classList.contains("nav-open") &&
    !nav.contains(e.target) &&
    !navToggle.contains(e.target)
  ) {
    header.classList.remove("nav-open");
  }
}, true);
</script>
</body>
</html>
