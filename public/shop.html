<!DOCTYPE html>
<html lang="en">
<head>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta charset="utf-8"/>
<title>Shop - WattSun</title>
<link href="main.css" rel="stylesheet"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrL3uFOW9vyvyehZ9erjRzMJ6qdNqGd+HEGhj2U1WPR4r6k6V2Q==" crossorigin="anonymous" referrerpolicy="no-referrer"/>
<style>
    html, body { height: 100%; min-height: 100%; box-sizing: border-box; }
    body { display: flex; flex-direction: column; min-height: 100vh; background: #fffdf7; }
    header {
  order: 0; flex-shrink: 0; }
    .container { max-width: 1200px; margin: 28px auto 0 auto; padding: 18px 5px 0 5px; flex: 1; display: flex; flex-direction: column; }
    h2 { text-align: center; margin-bottom: 12px; }
    .product-card { background: #fff; border-radius: 16px; box-shadow: 0 6px 28px -7px rgba(0,0,0,0.10); padding: 20px 18px 22px 18px; text-align: center; display: flex; flex-direction: column; align-items: center; min-width: 0; min-height: 0; border: none; transition: box-shadow 0.16s; }
    .product-card:hover { box-shadow: 0 12px 36px -9px #f7b73355; transform: translateY(-2px) scale(1.03); box-shadow: 0 6px 22px #f7b73333; }
    .product-card img, .product-img-placeholder { width: 100%; height: 90px; object-fit: cover; border-radius: 10px 10px 0 0; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); background: #f7f2e9; display: block; }
    .product-info { min-height: 102px; display: flex; flex-direction: column; justify-content: flex-start; align-items: center; width: 100%; }
    .product-card h3 { font-size: 1.17em; margin: 7px 0 4px 0; color: #191813; font-weight: bold; text-align: center; width: 100%; letter-spacing: 0.05em; }
    .product-card p { font-size: 14px; margin: 3px 0 0 0; color: #444; text-align: center; width: 100%; }
    .product-card input { width: 100%; padding: 10px; margin: 15px 0 10px 0; border-radius: 7px; border: 1px solid #eee1b9; font-size: 15px; }
    .product-card .loan-btn, .product-card button { background: linear-gradient(90deg, #f7b733 0%, #fcf6ba 100%); color: #965700 !important; padding: 7px 24px; font-size: 1em; font-weight: bold; border: none; border-radius: 9px; cursor: pointer; box-shadow: 0 3px 12px #f7b73333; transition: background 0.3s, transform 0.2s, box-shadow 0.2s; letter-spacing: 0.5px; width: auto; margin-top: 0; margin-bottom: 0; display: inline-block; align-self: center; min-width: 0; }
    .product-card .loan-btn:hover, .product-card button:hover { background: linear-gradient(90deg, #fcf6ba 0%, #f7b733 100%); color: #b37900 !important; }
    @media (max-width: 600px) {
      .container { padding: 0.5em; }
      .product-card img, .product-img-placeholder { height: 48px !important; max-height: 48px !important; }
      .product-info { min-height: 50px !important; margin-bottom: 0 !important; padding-bottom: 0 !important; }
      .grid { grid-template-columns: 1fr; gap: 16px 0; }
    }
    .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 36px 20px; }
    @media (max-width: 1000px) { .grid { grid-template-columns: 1fr 1fr; } }
    @media (max-width: 600px) { .grid { grid-template-columns: 1fr; gap: 16px 0; } }

    /* Cart Icon in NavBar */
    .cart-icon-link {
      position: relative;
      display: inline-block;
      text-decoration: none;
      color: inherit;
      vertical-align: middle;
      margin-left: 10px;
    }
    .cart-icon {
      font-size: 1.24em;
      display: flex;
      align-items: center;
      position: relative;
    }
    .cart-count-badge { position: absolute; top: -0.7em; right: -0.7em; background: #19c37d; color: #fff; border-radius: 50%; min-width: 18px; height: 18px; font-size: 0.8em; display: none; align-items: center; justify-content: center; box-shadow: 0 0 0.13em #0001; transition: background 0.2s; pointer-events: none; z-index: 1; }

    /* === Desktop & Mobile Logo Styles from index.html === */
    .logo-container { display: none; }
    .desktop-logo { display: block; }
    .brand-name { font-size: 1.8em; font-weight: bold; color: white; white-space: nowrap; }
    .site-logo { height: 48px; max-width: 48px; object-fit: contain; vertical-align: middle; }
    @media (max-width: 768px) {
      .desktop-logo { display: none; }
      .logo-container {
        display: flex;
        align-items: center;
        gap: 12px;
        white-space: nowrap;
        padding: 4px 12px;
        height: 56px;
        margin-left: 10px;
      }
      .site-logo { height: auto; max-height: 36px; object-fit: contain; }
      .brand-name { font-size: 1.3em; }
    }
    @media (max-width: 768px) {
      h1 img.site-logo { width: auto !important; max-height: 32px !important; margin-right: 8px; }
    }

html, body {
  height: 100%;
  margin: 0;
  display: flex;
  flex-direction: column;
}
.container {
  flex: 1;
}
/* --- Footer patch for full-width, centered content --- */
footer {
      width: 100%;
      background: linear-gradient(90deg,#f7b733 0%,#fcf6ba 100%);
      color: #6b5100;
      font-size: 1.08em;
      padding: 18px 0 5px 0;
      letter-spacing: 0.01em;
      font-family: inherit;
      flex-shrink: 0;
      border: none;
      box-sizing: border-box;
      position: relative;
      text-align: center;
}
.footer-inner {
  margin: 0 auto;
  text-align: center;
  max-width: 1200px;
  font-weight: normal;
  
}
.footer-contacts { display: inline; }
.footer-contacts a { color: #6b5100; text-decoration: underline; }
.footer-contacts a:hover { color: #a58512; }
/* --- end footer patch --- */

</style>
</head>
<body class="has-mobile-footer">
<div id="toast" style="display:none; position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:#3E9F50; color:white; padding:12px 20px; border-radius:8px; font-size:0.95em; box-shadow:0 4px 12px rgba(0,0,0,0.2); z-index:9999; transition:opacity 0.3s ease;">
    Added to cart!
  </div>
<header>
  <div class="header-bar">
    <h1 class="desktop-logo">
      <a class="logo-link" href="/index.html">
        <img alt="WattSun Solar Logo" src="assets/logo/Wattsun Solar log2.png" style="width: 60px; object-fit: contain; margin-right: 10px;"/>
        <span>WattSun Solar</span>
      </a>
    </h1>
    <div class="logo-container">
      <a class="logo-link" href="/index.html">
        <img alt="WattSun Solar Logo" class="site-logo" src="assets/logo/Wattsun Solar log2.png"/>
        <span class="brand-name">WattSun Solar</span>
      </a>
    </div>
    <div class="header-actions">
      <button onclick="openLogin()" id="loginBtn" style="background:#f4a940;color:white;border:none;padding:7px 18px;border-radius:5px;font-weight:600;font-size:1em;cursor:pointer;">Login</button>
      <span id="loggedInUser" style="display:none;font-size:1em;color:#222;"></span>
      <button id="logoutBtn" style="display:none;background:#f0701a;color:white;border:none;padding:7px 14px;border-radius:5px;font-size:1em;cursor:pointer;">Logout</button>
    </div>
    <button id="menu-toggle" class="menu-toggle" aria-label="Toggle navigation" aria-controls="primary-navigation" aria-expanded="false">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </div>
    <nav id="primary-navigation" class="nav-links" aria-label="Primary navigation">
    <a href="/index.html" class="nav-link-item" aria-label="Home"><i class="fas fa-home" aria-hidden="true"></i><span class="nav-text">Home</span></a>
    <a href="/solutions.html" class="nav-link-item" aria-label="Solutions"><i class="fas fa-lightbulb" aria-hidden="true"></i><span class="nav-text">Solutions</span></a>
    <a href="/shop.html" class="nav-link-item active" aria-label="Shop" aria-current="page"><i class="fas fa-store" aria-hidden="true"></i><span class="nav-text">Shop</span></a>
    <!-- <a href="/calculators/calculator.html" class="nav-link-item" aria-label="Calculator"><i class="fas fa-solar-panel" aria-hidden="true"></i><span class="nav-text">Calculator</span></a> -->
    <a href="/financing.html" class="nav-link-item" aria-label="Financing"><i class="fas fa-coins" aria-hidden="true"></i><span class="nav-text">Financing</span></a>
    <a href="/projects.html" class="nav-link-item" aria-label="Projects"><i class="fas fa-diagram-project" aria-hidden="true"></i><span class="nav-text">Projects</span></a>
    <!-- <a href="/myaccount/track.html" class="nav-link-item" aria-label="Track Order"><i class="fas fa-truck" aria-hidden="true"></i><span class="nav-text">Track Order</span></a> -->
    <a href="/contact.html" class="nav-link-item" aria-label="Contact"><i class="fas fa-envelope" aria-hidden="true"></i><span class="nav-text">Contact</span></a>
    <a class="nav-link-item cart-icon-link" href="/cart.html" aria-label="View cart"><span class="cart-icon"><i class="fas fa-shopping-cart" aria-hidden="true"></i><span class="nav-text">Cart</span><span id="cart-count-badge" class="cart-count-badge">0</span></span></a>
  </nav>
</header>
<div class="container" style="flex: 1;">
<h2>Available Solar Systems</h2>
<p style="text-align:center; font-style:italic; color:#666;">
      Note: A minimum deposit of 50% is required for installation to commence.
    </p>
<div class="grid" id="shop-products">
  <!-- Products will be dynamically loaded here -->
</div>
<script>
  function parsePrice(raw) {
    // Works for numbers like 27900 and strings like "KES 27,900"
    const s = (typeof raw === 'number') ? String(raw) : String(raw || '');
    return parseInt(s.replace(/[^\d]/g, ''), 10) || 0;
  }

  async function loadProducts() {
    const box = document.getElementById("shop-products");
    try {
      const res = await fetch("/api/items?active=1");
      const items = await res.json();
      box.innerHTML = "";
      items.forEach((prod, idx) => {
        const imgPath = prod.image ? "/images/products/" + prod.image : "/images/placeholder.jpg";
        const price = parsePrice(prod.price);
        const id = "dep_" + idx;

        const card = document.createElement('div');
        card.className = 'product-card';

        const img = document.createElement('img');
        img.src = imgPath;
        img.alt = String(prod.name || 'Product');
        img.onerror = function(){ this.src='/images/placeholder.jpg'; };
        card.appendChild(img);

        const info = document.createElement('div');
        info.className = 'product-info';
        const h3 = document.createElement('h3');
        h3.textContent = String(prod.name || '');
        const pDesc = document.createElement('p');
        pDesc.textContent = String(prod.description || '');
        const pTotal = document.createElement('p');
        pTotal.textContent = 'Total Price: KES ' + price.toLocaleString();
        info.appendChild(h3);
        info.appendChild(pDesc);
        info.appendChild(pTotal);
        card.appendChild(info);

        const input = document.createElement('input');
        input.id = id;
        input.type = 'number';
        input.placeholder = 'Enter your deposit (KES)';
        card.appendChild(input);

        const btn = document.createElement('button');
        btn.className = 'loan-btn';
        btn.textContent = 'Add to Cart';
        btn.addEventListener('click', () => addToCart(String(prod.name||''), price, id, String(prod.description||'')));
        card.appendChild(btn);

        box.appendChild(card);
      });
    } catch (e) {
      console.error("Failed to load products:", e);
      box.innerHTML = "<p style='color:red;'>Failed to load products.</p>";
    }
  }

  document.addEventListener('DOMContentLoaded', loadProducts);
</script>

<footer style="margin-top:48px;width:100%;background:linear-gradient(90deg,#f7b733 0%,#fcf6ba 100%);color:#6b5100;text-align:center;font-size:1.05rem;padding:16px 0 6px;letter-spacing:.01em;"><div class="footer-contacts"><a href="mailto:info@wattsun.co.ke" style="color:#6b5100;text-decoration:underline;">info@wattsun.co.ke</a></div><p>&copy; 2025 WattSun Solar. All rights reserved.</p></footer>

<footer class="mobile-footer" aria-label="Mobile navigation">
  <a href="/index.html"><i class="fas fa-home" aria-hidden="true"></i><span>Home</span></a>
  <a href="/shop.html" class="active"><i class="fas fa-store" aria-hidden="true"></i><span>Shop</span></a>
  <!-- <a href="/calculators/calculator.html"><i class="fas fa-solar-panel" aria-hidden="true"></i><span>Calc</span></a> -->
  <!-- <a href="/myaccount/track.html"><i class="fas fa-truck" aria-hidden="true"></i><span>Track</span></a> -->
  <a href="/myaccount/myorders.html"><i class="fas fa-user" aria-hidden="true"></i><span>Account</span></a>
</footer>

<script src="/js/menu.js?v=2025.10.24" defer></script>
  <script defer src="/js/auth.js"></script>
  <script src="main.js?v=20251020"></script>
</body>
</html>
