<!-- public/partials/admin-loyalty.html -->
<section class="card" id="loyalty-root" aria-labelledby="loyalty-title">
  <header class="card-header">
    <h2 id="loyalty-title" class="card-title">Loyalty Program</h2>
    <div class="spacer"></div>
    <div class="btn-group" role="group">
      <button id="tabWithdrawalsBtn" class="btn">Withdrawals</button>
      <button id="tabAccountsBtn" class="btn btn--ghost">Accounts</button>
      <button id="tabLedgerBtn" class="btn btn--ghost">Ledger</button>
      <button id="tabNotifsBtn" class="btn btn--ghost">Notifications</button>
    </div>
  </header>

  <div class="card-body">
   <!-- Filters -->
<form id="loyalty-filters" class="filters-bar" autocomplete="off">
  <!-- Withdrawals Filter -->
  <div class="group" id="filterWithdrawals">
    <label for="statusSel">Status</label>
    <select id="statusSel" name="status">
      <option value="">All</option>
      <option value="Pending">Pending</option>
      <option value="Approved">Approved</option>
      <option value="Rejected">Rejected</option>
      <option value="Paid">Paid</option>
    </select>
  </div>

  <!-- Accounts Filter -->
  <div class="group" id="filterAccounts" style="display:none;">
    <label for="accStatusSel">Status</label>
    <select id="accStatusSel" name="accStatus">
      <option value="">All</option>
      <option value="Active">Active</option>
      <option value="Closed">Closed</option>
      <option value="Suspended">Suspended</option>
    </select>
  </div>

  <!-- Ledger Filter -->
  <div class="group" id="filterLedger" style="display:none;">
    <label for="ledgerKindSel">Kind</label>
    <select id="ledgerKindSel" name="kind">
      <option value="">All</option>
      <option value="Earn">Earn</option>
      <option value="Penalty">Penalty</option>
      <option value="Withdraw">Withdraw</option>
      <option value="Deposit">Deposit</option>
    </select>
  </div>

  <!-- Notifications Filter -->
  <div class="group" id="filterNotifs" style="display:none;">
    <label for="notifStatusSel">Status</label>
    <select id="notifStatusSel" name="notifStatus">
      <option value="">All</option>
      <option value="Sent">Sent</option>
      <option value="Failed">Failed</option>
      <option value="Pending">Pending</option>
    </select>
  </div>

  <!-- Search + buttons (always visible, aligned right) -->
  <div class="group" style="margin-left:auto; display:flex; align-items:flex-end; gap:0.5rem;">
    <div>
      <label for="loyaltySearch">Search</label>
      <input id="loyaltySearch" name="q" class="input" placeholder="Find record…" />
    </div>
    <button type="button" id="loyaltyClearBtn" class="btn">Clear</button>
    <button type="button" id="loyaltyRefreshBtn" class="btn">Refresh</button>
  <button type="button" id="accManageBtn" class="btn" style="display:none;">Manage</button>
  </div>
</form>

    <!-- Withdrawals Table -->
    <div id="loyaltyTabWithdrawals" class="loyalty-tab">
      <table class="table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Account</th>
            <th>User</th>
            <th>Points</th>
            <th>Status</th>
            <th>Requested</th>
            <th>Decided</th>
            <th>Paid</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="wdBody">
          <tr><td colspan="9" class="muted">(No data yet)</td></tr>
        </tbody>
      </table>
    </div>

    <!-- Accounts Table -->
    <div id="loyaltyTabAccounts" class="loyalty-tab" style="display:none;">
      <table class="table">
        <thead>
          <tr>
            <th>ID</th>
            <th>User ID</th>
            <th>Email</th>
            <th>Status</th>
            <th>Start</th>
            <th>End</th>
            <th>Duration (mo)</th>
            <th>Balance</th>
            <th>Earned</th>
            <th>Penalty</th>
            <th>Paid</th>
          </tr>
        </thead>
        <tbody id="loyaltyAccountsBody">
          <tr><td colspan="11" class="muted">(No data yet)</td></tr>
        </tbody>
      </table>
    </div>

    <!-- Ledger Table -->
    <div id="loyaltyTabLedger" class="loyalty-tab" style="display:none;">
      <table class="table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Account</th>
            <th>Kind</th>
            <th>Δ Points</th>
            <th>Note</th>
            <th>When</th>
          </tr>
        </thead>
        <tbody id="loyaltyLedgerBody">
          <tr><td colspan="6" class="muted">(No data yet)</td></tr>
        </tbody>
      </table>
    </div>

    <!-- Notifications Table -->
    <div id="loyaltyTabNotifs" class="loyalty-tab" style="display:none;">
      <table class="table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Kind</th>
            <th>Email</th>
            <th>Status</th>
            <th>Created</th>
          </tr>
        </thead>
        <tbody id="loyaltyNotificationsBody">
          <tr><td colspan="5" class="muted">(No data yet)</td></tr>
        </tbody>
      </table>
    </div>

    <!-- Shared Meta Bar + Pagination -->
<footer class="table-meta" style="display:flex; align-items:center; justify-content:space-between;">
  <div id="loyaltyMeta" class="meta">0 results</div>
  <div class="pager" id="loyaltyPager">
    <button class="btn btn--small">First</button>
    <button class="btn btn--small">« Prev</button>
    <span>1</span>
    <button class="btn btn--small">Next »</button>
    <button class="btn btn--small">Last</button>
  </div>
</footer>

  </div>

  <!-- Minimal native dialog for Manage actions (status/extend/penalize) -->
  <dialog id="accManageDialog" class="modal">
  <form method="dialog" class="card" style="min-width:560px; max-width:720px;">
    <header class="card-header" style="display:flex;align-items:center;justify-content:space-between;">
      <h3 class="card-title">Manage Loyalty Account</h3>
      <button value="close" class="btn" aria-label="Close">✕</button>
    </header>

    <div class="card-body" style="display:flex;flex-direction:column;gap:1rem;">

      <div class="row" style="gap:1rem;">
        <div class="group" style="flex:1;">
          <label for="mAccId">Account ID</label>
          <input id="mAccId" type="number" class="input" placeholder="e.g. 1">
        </div>
        <div class="group" style="flex:1;">
          <label for="mUserId">User ID</label>
          <input id="mUserId" type="number" class="input" placeholder="e.g. 42">
        </div>
      </div>

      <fieldset class="card" style="padding:0.75rem;">
        <legend class="muted">Status</legend>
        <div class="row" style="gap:0.75rem;align-items:flex-end;">
          <div class="group" style="min-width:200px;">
            <label for="mStatus">New status</label>
            <select id="mStatus" class="input">
              <option>Active</option>
              <option>Paused</option>
              <option>Suspended</option>
              <option>Closed</option>
            </select>
          </div>
          <div class="group">
            <label>&nbsp;</label>
            <button type="button" id="mUpdateStatus" class="btn">Update Status</button>
          </div>
        </div>
      </fieldset>

      <fieldset class="card" style="padding:0.75rem;">
        <legend class="muted">Extend</legend>
        <div class="row" style="gap:0.75rem;align-items:flex-end;">
          <div class="group" style="width:120px;">
            <label for="mExtendMonths">Months</label>
            <input id="mExtendMonths" type="number" min="1" value="1" class="input">
          </div>
          <div class="group" style="flex:1;">
            <label for="mExtendNote">Note (optional)</label>
            <input id="mExtendNote" class="input" placeholder="reason or note">
          </div>
          <div class="group">
            <label>&nbsp;</label>
            <button type="button" id="mExtend" class="btn">Extend</button>
          </div>
        </div>
      </fieldset>

      <fieldset class="card" style="padding:0.75rem;">
        <legend class="muted">Penalty</legend>
        <div class="row" style="gap:0.75rem;align-items:flex-end;">
          <div class="group" style="width:140px;">
            <label for="mPenaltyPoints">Points</label>
            <input id="mPenaltyPoints" type="number" min="1" value="10" class="input">
          </div>
          <div class="group" style="flex:1;">
            <label for="mPenaltyNote">Reason</label>
            <input id="mPenaltyNote" class="input" placeholder="reason for penalty">
          </div>
          <div class="group">
            <label>&nbsp;</label>
            <button type="button" id="mPenalize" class="btn danger">Penalize</button>
          </div>
        </div>
      </fieldset>

      <div class="group">
        <label class="muted">Response</label>
        <pre id="mOut" class="mono small" style="background:#fafafa;border:1px solid #eee;padding:.5rem;max-height:180px;overflow:auto;"></pre>
      </div>
    </div>
  </form>
</dialog>

</section>
