<!-- public/partials/orders-add.html -->
<dialog id="orderAddModal" class="modal" aria-labelledby="oa_title" aria-modal="true">
  <div class="modal-card">
    <header class="modal-header">
      <h3 id="oa_title">Add Order</h3>
    </header>

    <form id="orderAddForm" class="modal-body" method="dialog">
      <!-- Customer -->
      <fieldset class="card soft">
        <legend>Customer</legend>
        <div class="grid two">
          <label class="field">
            <span>Customer Name</span>
            <input id="oa_fullName" name="fullName" type="text" class="input" placeholder="John Doe" autocomplete="name" required />
          </label>
          <label class="field">
            <span>Phone</span>
            <input id="oa_phone" name="phone" type="tel" class="input" placeholder="+2547XXXXXXXX" autocomplete="tel" required />
          </label>
        </div>
        <label class="field">
          <span>Email</span>
          <input id="oa_email" name="email" type="email" class="input" placeholder="john@example.com" autocomplete="email" />
        </label>
      </fieldset>

      <!-- Order -->
      <fieldset class="card soft">
        <legend>Order</legend>
        <div class="grid two">
          <label class="field">
            <span>Status</span>
            <select id="oa_status" name="status" class="input" required>
              <option value="Pending" selected>Pending</option>
              <option value="Confirmed">Confirmed</option>
              <option value="Dispatched">Dispatched</option>
              <option value="Delivered">Delivered</option>
              <option value="Closed">Closed</option>
              <option value="Cancelled">Cancelled</option>
            </select>
          </label>
          <label class="field">
            <span>Currency</span>
            <select id="oa_currency" name="currency" class="input" required>
              <option value="KES" selected>KES</option>
              <option value="USD">USD</option>
            </select>
          </label>
        </div>

        <div class="grid two">
          <label class="field">
            <span>Total (cents)</span>
            <input id="oa_totalCents" name="totalCents" type="number" class="input" inputmode="numeric" placeholder="e.g. 25000" min="0" />
          </label>
          <label class="field">
            <span>Deposit (cents)</span>
            <input id="oa_depositCents" name="depositCents" type="number" class="input" inputmode="numeric" placeholder="e.g. 5000" min="0" />
          </label>
        </div>

        <label class="field">
          <span>Notes</span>
          <textarea id="oa_notes" name="notes" rows="3" class="input" placeholder="Phone order, customer prefers delivery on Fridayâ€¦"></textarea>
        </label>
      </fieldset>

      <!-- Items -->
      <fieldset class="card soft">
        <legend>Items (optional)</legend>
        <div class="table-wrap" style="overflow-x:auto;">
          <table class="table" id="oa_itemsTable" aria-label="Order items">
            <thead>
              <tr>
                <th style="width:45%;">SKU</th>
                <th style="width:20%;">Qty</th>
                <th style="width:20%;">&nbsp;</th>
              </tr>
            </thead>
            <tbody id="oa_itemsBody">
              <tr>
                <td><input type="text" class="input oa_item_sku" placeholder="FLA12100" /></td>
                <td><input type="number" class="input oa_item_qty" placeholder="1" min="1" value="1" /></td>
                <td><button class="btn small ghost oa_row_remove" type="button">Remove</button></td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="row">
          <button id="oa_addRow" class="btn small" type="button">+ Add Item</button>
        </div>
        <p class="hint">First version keeps items minimal: SKU + Qty. (Advanced pricing/name later.)</p>
      </fieldset>
    </form>

    <footer class="modal-footer">
      <button type="button" class="btn ghost" data-close>Cancel</button>
      <button type="submit" class="btn primary" form="orderAddForm">Save</button>
    </footer>
  </div>
</dialog>

<script>
  (function () {
    const dlg = document.getElementById("orderAddModal");
    const form = document.getElementById("orderAddForm");

    // Cancel closes modal
    dlg.querySelectorAll("[data-close]").forEach(btn => {
      btn.addEventListener("click", () => {
        try { dlg.close(); } catch { dlg.removeAttribute("open"); }
      });
    });

    // Save emits event for handler
    form?.addEventListener("submit", (e) => {
      e.preventDefault();
      window.dispatchEvent(new CustomEvent("orders:add:submit", { detail: new FormData(form) }));
      try { dlg.close(); } catch { dlg.removeAttribute("open"); }
    });
  })();
</script>
