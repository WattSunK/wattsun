<!-- System Status (top card) -->
<section class="card">
  <div class="card-header">System Status</div>
  <div class="card-body">
    <!-- Local styles ONLY for the status board UI -->
    <style>
      .status-board { display: flex; flex-direction: column; gap: 10px; }
      .status-line { display: flex; align-items: center; gap: 10px; }
      .status-label { min-width: 140px; font-weight: 600; }
      .pill { flex: 1; background: rgba(0,0,0,.03); border-radius: 10px; padding: 8px 12px;
              display: flex; align-items: center; gap: 8px; }
      .dot { width: 10px; height: 10px; border-radius: 50%; background: #c9c9c9; }
      .dot.ok { background: #2ecc71; }     /* green */
      .dot.bad { background: #e74c3c; }    /* red   */
      .status-meta { margin-top: 6px; font-size: .9rem; color: #666; }
    </style>

    <div class="status-board" aria-live="polite">
      <div class="status-line">
        <span class="status-label">Backend API:</span>
        <div class="pill">
          <span class="dot" id="apiDot"></span>
          <span id="apiText">Checking...</span>
        </div>
      </div>
      <div class="status-line">
        <span class="status-label">Cloudflare Tunnel:</span>
        <div class="pill">
          <span class="dot" id="tunnelDot"></span>
          <span id="tunnelText">Checking...</span>
        </div>
      </div>
      <div class="status-meta">
        Last checked: <span id="statusChecked">—</span> — auto-refreshes every 30s
      </div>
    </div>
  </div>
</section>

<!-- Dashboard cards row (containers/grid come from admin.css) -->
<div class="dash-cards">
  <!-- Recent Orders -->
  <section class="card">
    <div class="card-header">Recent Orders</div>
    <div class="card-body">
      <div class="order-line">
        <div><strong>Placed</strong> &nbsp;<span id="dashOrderPlaced">Mon, 19 Jan, 11:32 AM</span></div>
        <div><strong>Chez Panisse.</strong> &nbsp;<span id="dashOrderAmount">KSh 252.95</span></div>
        <div>Order ID: <span id="dashOrderId">1585922175843</span></div>
      </div>

      <div class="actions">
        <button class="btn" id="btnDashTrackOrder">Track Order</button>
        <button class="btn" id="btnDashCancelOrder">Cancel Order</button>
        <button class="btn" id="btnDashHelp">Help</button>
      </div>

      <div class="links">
        <a href="#" id="dashOrderItemsLink">View 1 item ordered ▸</a>
        &nbsp;&nbsp;
        <a href="#" id="dashOrderAddressLink">View Address And Billing Details ▸</a>
      </div>
    </div>
  </section>

  <!-- Items -->
  <section class="card">
    <div class="card-header">Items</div>
    <div class="card-body">
      <div><strong>Active Item</strong></div>
      <div>SKU: <span id="dashItemSku">J23456450.50</span></div>
      <div>STOCK: <span id="dashItemStock">9</span></div>

      <div class="vspace-8"></div>
      <div><strong>John Doe</strong></div>
      <div>Phone: <span id="dashItemPhone">+254 123456789</span></div>
      <div>Email: <span id="dashItemEmail">john@email.com</span></div>

      <div class="actions">
        <button class="btn" id="btnDashItemsEdit">Edit</button>
      </div>
    </div>
  </section>

  <!-- Dispatch -->
  <section class="card">
    <div class="card-header">Dispatch</div>
    <div class="card-body">
      <div><strong>Delivery dispatch</strong></div>
      <div>Order #<span id="dashDispOrder">123456</span></div>
      <div>Delivery #<span id="dashDispNo">80</span></div>
      <div>Order #123456 - Out for delivery</div>

      <div class="vspace-8"></div>
      <div><strong>Status</strong></div>
      <div id="dashDispStatus">Out for delivery</div>

      <div class="actions">
        <button class="btn" id="btnDashDispatchTrack">Track</button>
      </div>
    </div>
  </section>
</div>

<script>
  // Lightweight status checker (30s); containers come from admin.css
  (function(){
    const $ = (id) => document.getElementById(id);
    async function ping(url, dotId, txtId, okText, badText){
      try{
        const r = await fetch(url, { credentials: 'same-origin' });
        const ok = r.ok;
        const dot = $(dotId), txt = $(txtId);
        if (!dot || !txt) return;
        dot.classList.toggle('ok', ok);
        dot.classList.toggle('bad', !ok);
        txt.textContent = ok ? okText : badText;
      }catch(_){
        const dot = $(dotId), txt = $(txtId);
        if (dot){ dot.classList.remove('ok'); dot.classList.add('bad'); }
        if (txt){ txt.textContent = badText; }
      }
    }
    async function check(){
      await ping('/api/health', 'apiDot', 'apiText', 'OK', 'Down');
      await ping('/api/health?tunnel=1', 'tunnelDot', 'tunnelText', 'Connected', 'Disconnected');
      const s = $('statusChecked'); if (s) s.textContent = new Date().toLocaleTimeString();
    }
    check();
    setInterval(check, 30000);

    function navTo(partial){
      const link = document.querySelector('.admin-nav .nav-link[data-partial="'+partial+'"]');
      if (link) link.click();
    }
    document.getElementById('btnDashTrackOrder')?.addEventListener('click', () => navTo('orders'));
    document.getElementById('btnDashCancelOrder')?.addEventListener('click', () => navTo('orders'));
    document.getElementById('btnDashHelp')?.addEventListener('click', () => navTo('orders'));
    document.getElementById('btnDashItemsEdit')?.addEventListener('click', () => navTo('items'));
    document.getElementById('btnDashDispatchTrack')?.addEventListener('click', () => navTo('dispatch'));
  })();
</script>
