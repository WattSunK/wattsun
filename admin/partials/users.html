<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Users | WattSun Admin</title>
  <link href="main.css" rel="stylesheet"/>
</head>
<body>
<h2 class="items-title">Users</h2>
<div class="items-toolbar">
  <button class="items-btn" id="add-user-btn">+ Add User</button>
  <select class="items-select" id="user-type-filter">
    <option value="All">All Types</option>
    <option value="Customer">Customer</option>
    <option value="Installer">Installer</option>
    <option value="Admin">Admin</option>
    <option value="Manufacturer">Manufacturer</option>
  </select>
  <select class="items-select" id="user-status-filter">
    <option value="All">All Status</option>
    <option value="Active">Active</option>
    <option value="Inactive">Inactive</option>
  </select>
  <input class="items-input" type="text" placeholder="Search by name/email/phone">
  <button class="items-btn">Search</button>
  <button class="items-btn items-btn-clear">Clear</button>
</div>
<div class="items-table-wrapper">
  <table class="items-table">
    <thead>
      <tr>
        <th>SL NO.</th>
        <th>NAME</th>
        <th>EMAIL</th>
        <th>PHONE</th>
        <th>TYPE</th>
        <th>ORDERS</th>
        <th>STATUS</th>
        <th>LAST ACTIVE</th>
        <th>ACTION</th>
      </tr>
    </thead>
    <tbody id="users-table-body">
      <!-- Dynamic user rows will appear here -->
    </tbody>
  </table>
  <div class="items-pagination">
    <span id="pagination-info">Showing 0 of 0 entries</span>
    <div>
      <button class="items-page-btn" disabled>First</button>
      <button class="items-page-btn" disabled>Previous</button>
      <button class="items-page-btn active">1</button>
      <button class="items-page-btn" disabled>Next</button>
      <button class="items-page-btn" disabled>Last</button>
    </div>
  </div>
</div>
<script>
async function loadUsers() {
  const tbody = document.getElementById('users-table-body');
  tbody.innerHTML = '<tr><td colspan="9">Loading...</td></tr>';
  try {
    const res = await fetch('/api/users');
    const users = await res.json();
    const info = document.getElementById('pagination-info');
    if (!Array.isArray(users) || users.length === 0) {
      tbody.innerHTML = '<tr><td colspan="9">No users found</td></tr>';
      info.textContent = 'Showing 0 of 0 entries';
      return;
    }
    tbody.innerHTML = '';
    users.forEach((user, i) => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${i+1}</td>
        <td class="items-link">${user.name}</td>
        <td>${user.email}</td>
        <td>${user.phone || ''}</td>
        <td>${user.type}</td>
        <td>${user.orders || 0}</td>
        <td><span class="items-status ${user.status && user.status.toLowerCase() === 'active' ? 'active' : ''}">${user.status}</span></td>
        <td>${user.last_active ? (new Date(user.last_active)).toLocaleDateString() : ''}</td>
        <td>
          <button class="items-action-btn view-user-btn" title="View">View</button>
          <button class="items-action-btn edit-user-btn" title="Edit">Edit</button>
          <button class="items-action-btn delete-user-btn" title="Delete">Delete</button>
        </td>
      `;
      tbody.appendChild(row);
    });
    info.textContent = `Showing ${users.length} of ${users.length} entries`;
  } catch (e) {
    tbody.innerHTML = '<tr><td colspan="9">Failed to load users</td></tr>';
    document.getElementById('pagination-info').textContent = 'Error loading entries';
  }
}

window.addEventListener('DOMContentLoaded', loadUsers);
</script>
</body>
</html>
